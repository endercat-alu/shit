<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁåúShitÊ∏∏Êàè</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <style>
        /* --- Âü∫Á°ÄÊ†∑Âºè --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
            overflow: hidden;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .title {
            text-align: center;
            color: white;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .game-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .boxes-container {
            position: relative;
            width: 80%;
            height: 60%;
            max-width: 800px;
            max-height: 400px;
        }

        .box {
            position: absolute;
            width: 80px;
            height: 80px;
            background: #fff;
            border: 3px solid #333;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            user-select: none;
        }

        .box:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        .box.hidden {
            background: #ddd;
        }

        .box.hidden .content {
            display: none;
        }

        .box.correct {
            background: #4CAF50;
            animation: bounce 0.5s ease;
        }

        .box.wrong {
            background: #f44336;
            animation: shake 0.5s ease;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            80% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .controls {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: bold;
            color: #333;
        }

        .control-group input {
            width: 60px;
            padding: 5px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
        }



        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5em;
            text-align: center;
            z-index: 1000;
            display: none;
        }

        .message.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .countdown {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .status-hint {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            z-index: 100;
            display: none;
        }

        .status-hint.show {
            display: block;
            animation: fadeInOut 2s ease;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(10px); }
            20%, 80% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }

        /* ÊâãÊú∫ÈÄÇÈÖçÊ†∑Âºè */
        .mobile-gaming .title {
            display: none;
        }

        .mobile-gaming .controls {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            padding: 8px 15px;
            border-radius: 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .mobile-gaming .controls .control-group {
            display: none;
        }

        .mobile-gaming .controls #gameBtn {
            padding: 8px 16px;
            font-size: 14px;
            margin: 0;
        }

        .mobile-gaming .game-area {
            padding-top: 60px; /* ‰∏∫È°∂ÈÉ®ÊåâÈíÆÁïôÂá∫Á©∫Èó¥ */
        }

        /* Ê£ÄÊµãÊâãÊú∫ËÆæÂ§á */
        @media (max-width: 768px) and (pointer: coarse) {
            .game-container {
                padding: 10px;
            }

            .title {
                font-size: 2em;
                margin-bottom: 15px;
            }

            .controls {
                padding: 15px;
                gap: 15px;
            }

            .control-group label {
                font-size: 14px;
            }

            .control-group input {
                width: 50px;
                font-size: 14px;
            }

            .btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title">üéØ ÁåúShitÊ∏∏Êàè üí©</h1>
        
        <div class="game-area">
            <div class="boxes-container" id="boxesContainer">
                <!-- ÁõíÂ≠êÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
            </div>
            <div class="countdown" id="countdown" style="display: none;"></div>
            <div class="status-hint" id="statusHint"></div>
        </div>

        <div class="message" id="message"></div>

        <div class="controls">
            <div class="control-group">
                <label for="totalBoxes">ÊÄªÁõíÂ≠êÊï∞ (N):</label>
                <input type="number" id="totalBoxes" min="2" max="10" value="3">
            </div>
            <div class="control-group">
                <label for="cleanBoxes">Êó†shitÁõíÂ≠êÊï∞ (n):</label>
                <input type="number" id="cleanBoxes" min="1" max="5" value="1">
            </div>
            <div class="control-group">
                <label for="showTime">ÊòæÁ§∫Êó∂Èó¥ (tÁßí):</label>
                <input type="number" id="showTime" min="1" max="10" value="1">
            </div>
            <div class="control-group">
                <label for="animationSpeed">Âä®ÁîªÈÄüÂ∫¶:</label>
                <input type="number" id="animationSpeed" min="0.5" max="5" step="0.1" value="1.5">
            </div>
            <div class="control-group">
                <label for="delayTime">Âª∂ËøüÊó∂Èó¥ (t1Áßí):</label>
                <input type="number" id="delayTime" min="0" value="5">
            </div>
            <button class="btn" id="gameBtn" onclick="toggleGame()">ÂºÄÂßãÊ∏∏Êàè</button>
        </div>
    </div>

    <script>
        // Ê∏∏ÊàèÁä∂ÊÄÅ
        let gameState = {
            isPlaying: false,
            isShowing: false,
            canSelect: false,
            boxes: [],
            cleanBoxIndices: [],
            totalBoxes: 3,
            cleanBoxes: 1,
            showTime: 1,
            delayTime: 5,
            animationSpeed: 1.5,
            animationId: null,
            startTime: 0,
            isMobile: false
        };

        // Ê£ÄÊµãÊòØÂê¶‰∏∫ÊâãÊú∫ËÆæÂ§á
        function detectMobile() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobileUA = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const isSmallScreen = window.innerWidth <= 768;

            gameState.isMobile = isMobileUA && isTouchDevice && isSmallScreen;
            return gameState.isMobile;
        }

        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            const container = document.getElementById('boxesContainer');
            container.innerHTML = '';
            gameState.boxes = [];

            // Ëé∑ÂèñÂèÇÊï∞
            gameState.totalBoxes = parseInt(document.getElementById('totalBoxes').value);
            gameState.cleanBoxes = parseInt(document.getElementById('cleanBoxes').value);
            gameState.showTime = parseInt(document.getElementById('showTime').value);
            gameState.delayTime = parseInt(document.getElementById('delayTime').value);
            gameState.animationSpeed = parseFloat(document.getElementById('animationSpeed').value);

            // È™åËØÅÂèÇÊï∞
            if (gameState.cleanBoxes >= gameState.totalBoxes) {
                showMessage('Êó†shitÁõíÂ≠êÊï∞‰∏çËÉΩÂ§ß‰∫éÁ≠â‰∫éÊÄªÁõíÂ≠êÊï∞ÔºÅ');
                return false;
            }

            // ÈöèÊú∫ÈÄâÊã©Âì™‰∫õÁõíÂ≠êÊòØÂπ≤ÂáÄÁöÑ
            gameState.cleanBoxIndices = [];
            while (gameState.cleanBoxIndices.length < gameState.cleanBoxes) {
                const index = Math.floor(Math.random() * gameState.totalBoxes);
                if (!gameState.cleanBoxIndices.includes(index)) {
                    gameState.cleanBoxIndices.push(index);
                }
            }

            // ÂàõÂª∫ÁõíÂ≠ê
            for (let i = 0; i < gameState.totalBoxes; i++) {
                const box = createBox(i);
                gameState.boxes.push(box);
                container.appendChild(box.element);
            }

            // ÂàùÂßã‰ΩçÁΩÆÊéíÂàó
            arrangeBoxes();
            return true;
        }

        // ÂàõÂª∫Âçï‰∏™ÁõíÂ≠ê
        function createBox(index) {
            const element = document.createElement('div');
            element.className = 'box';
            element.onclick = () => selectBox(index);

            const content = document.createElement('div');
            content.className = 'content';
            content.textContent = gameState.cleanBoxIndices.includes(index) ? '‚ú®' : 'üí©';
            element.appendChild(content);

            return {
                element: element,
                index: index,
                x: 0,
                y: 0,
                targetX: 0,
                targetY: 0,
                isClean: gameState.cleanBoxIndices.includes(index)
            };
        }

        // ÊéíÂàóÁõíÂ≠êÂàùÂßã‰ΩçÁΩÆ
        function arrangeBoxes() {
            const container = document.getElementById('boxesContainer');
            const containerRect = container.getBoundingClientRect();
            const boxSize = 80;
            const gap = 20;

            // ËÆ°ÁÆóÁΩëÊ†ºÂ∏ÉÂ±Ä
            const cols = Math.ceil(Math.sqrt(gameState.totalBoxes));
            const rows = Math.ceil(gameState.totalBoxes / cols);

            const totalWidth = cols * boxSize + (cols - 1) * gap;
            const totalHeight = rows * boxSize + (rows - 1) * gap;

            const startX = (containerRect.width - totalWidth) / 2;
            const startY = (containerRect.height - totalHeight) / 2;

            gameState.boxes.forEach((box, index) => {
                const row = Math.floor(index / cols);
                const col = index % cols;

                box.x = startX + col * (boxSize + gap);
                box.y = startY + row * (boxSize + gap);
                box.targetX = box.x;
                box.targetY = box.y;

                box.element.style.left = box.x + 'px';
                box.element.style.top = box.y + 'px';
            });
        }

        // Êô∫ËÉΩÊ∏∏ÊàèÊåâÈíÆÂàáÊç¢
        function toggleGame() {
            if (gameState.isPlaying) {
                resetGame();
            } else {
                startGame();
            }
        }

        // ÂºÄÂßãÊ∏∏Êàè
        function startGame() {
            if (!initGame()) return;

            gameState.isPlaying = true;
            gameState.isShowing = true;
            gameState.canSelect = false;
            gameState.startTime = Date.now();

            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            updateGameButton();

            // ÊâãÊú∫ÈÄÇÈÖçÔºöÈöêËóèÊéßÂà∂Ê†èÂíåÊ†áÈ¢ò
            if (gameState.isMobile) {
                document.body.classList.add('mobile-gaming');
            }

            // Á¶ÅÁî®ÊéßÂà∂ÂèÇÊï∞
            document.getElementById('totalBoxes').disabled = true;
            document.getElementById('cleanBoxes').disabled = true;
            document.getElementById('showTime').disabled = true;
            document.getElementById('delayTime').disabled = true;
            document.getElementById('animationSpeed').disabled = true;

            // ÊòæÁ§∫ÂÜÖÂÆπÁâ©
            gameState.boxes.forEach(box => {
                box.element.classList.remove('hidden');
            });

            // ÂºÄÂßãÂÄíËÆ°Êó∂
            startCountdown();
        }

        // ÂÄíËÆ°Êó∂ÊòæÁ§∫
        function startCountdown() {
            const countdownEl = document.getElementById('countdown');
            countdownEl.style.display = 'block';
            let timeLeft = gameState.showTime;

            const updateCountdown = () => {
                countdownEl.textContent = `${timeLeft}Áßí`;
                timeLeft--;

                if (timeLeft < 0) {
                    countdownEl.style.display = 'none';
                    hideContents();
                } else {
                    setTimeout(updateCountdown, 1000);
                }
            };

            updateCountdown();
        }

        // ÈöêËóèÂÜÖÂÆπÂπ∂ÂºÄÂßãÂä®Áîª
        function hideContents() {
            gameState.isShowing = false;

            // ÈöêËóèÊâÄÊúâÁõíÂ≠êÂÜÖÂÆπ
            gameState.boxes.forEach(box => {
                box.element.classList.add('hidden');
            });

            // ÂºÄÂßãÁßªÂä®Âä®Áîª
            startAnimation();

            // ËÆæÁΩÆÂª∂ËøüÂêéÂÖÅËÆ∏ÈÄâÊã©
            setTimeout(() => {
                if (gameState.isPlaying) {
                    gameState.canSelect = true;
                    showStatusHint('ÂèØ‰ª•ÈÄâÊã©‰∫Ü');
                }
            }, gameState.delayTime * 1000);
        }

        // ÂºÄÂßãÁõíÂ≠êÊ∑∑Ê≤åËøêÂä®Âä®Áîª
        function startAnimation() {
            const container = document.getElementById('boxesContainer');
            const containerRect = container.getBoundingClientRect();

            // ‰∏∫ÊØè‰∏™ÁõíÂ≠êËÆæÁΩÆÊ∑∑Ê≤åËøêÂä®ÂèÇÊï∞
            gameState.boxes.forEach((box, index) => {
                // ÊØè‰∏™ÁõíÂ≠êÊúâ‰∏çÂêåÁöÑÊ∑∑Ê≤åÂèÇÊï∞
                box.chaosA = 2.5 + Math.random() * 2; // Ê∑∑Ê≤åÁ≥ªÊï∞A
                box.chaosB = 1.8 + Math.random() * 1.5; // Ê∑∑Ê≤åÁ≥ªÊï∞B
                box.chaosC = 0.3 + Math.random() * 0.4; // Ê∑∑Ê≤åÁ≥ªÊï∞C
                box.phase = Math.random() * Math.PI * 2; // Áõ∏‰ΩçÂÅèÁßª
                box.centerX = containerRect.width / 2; // ‰∏≠ÂøÉX
                box.centerY = containerRect.height / 2; // ‰∏≠ÂøÉY
                box.radiusX = (containerRect.width - 80) * 0.4; // XËΩ¥ÂçäÂæÑ
                box.radiusY = (containerRect.height - 80) * 0.4; // YËΩ¥ÂçäÂæÑ
            });

            // Âä®ÁîªÂæ™ÁéØ
            const animate = () => {
                const currentTime = (Date.now() - gameState.startTime) / 1000; // ÂΩìÂâçÊó∂Èó¥ÔºàÁßíÔºâ
                const speed = gameState.animationSpeed;

                gameState.boxes.forEach((box, index) => {
                    // Ê∑∑Ê≤åËøêÂä®ÊñπÁ®ã - Âü∫‰∫éÊ¥õ‰º¶ÂÖπÂê∏ÂºïÂ≠êÁöÑÂèòÂΩ¢
                    const t = currentTime * speed + box.phase;

                    // ‰ΩøÁî®Â§ö‰∏™Ê≠£Âº¶Âíå‰ΩôÂº¶ÂáΩÊï∞ÂàõÂª∫Â§çÊùÇÁöÑÊ∑∑Ê≤åËΩ®Ëøπ
                    const x1 = Math.sin(t * box.chaosA) * Math.cos(t * box.chaosB);
                    const y1 = Math.cos(t * box.chaosA) * Math.sin(t * box.chaosB);
                    const x2 = Math.sin(t * box.chaosC) * 0.5;
                    const y2 = Math.cos(t * box.chaosC) * 0.5;

                    // ÁªÑÂêàÂ§ö‰∏™Ê∑∑Ê≤åÂàÜÈáè
                    const chaosX = (x1 + x2) * box.radiusX;
                    const chaosY = (y1 + y2) * box.radiusY;

                    // ËÆ°ÁÆóÊúÄÁªà‰ΩçÁΩÆ
                    box.x = box.centerX + chaosX - 40; // ÂáèÂéªÁõíÂ≠êÂÆΩÂ∫¶ÁöÑ‰∏ÄÂçä
                    box.y = box.centerY + chaosY - 40; // ÂáèÂéªÁõíÂ≠êÈ´òÂ∫¶ÁöÑ‰∏ÄÂçä

                    // Á°Æ‰øùÁõíÂ≠êÂú®ËæπÁïåÂÜÖ
                    box.x = Math.max(0, Math.min(containerRect.width - 80, box.x));
                    box.y = Math.max(0, Math.min(containerRect.height - 80, box.y));

                    box.element.style.left = box.x + 'px';
                    box.element.style.top = box.y + 'px';
                });

                if (gameState.isPlaying) {
                    gameState.animationId = requestAnimationFrame(animate);
                }
            };

            animate();
        }

        // ÈÄâÊã©ÁõíÂ≠ê
        function selectBox(index) {
            if (!gameState.isPlaying || gameState.isShowing || !gameState.canSelect) {
                if (!gameState.canSelect && gameState.isPlaying && !gameState.isShowing) {
                    showStatusHint('ËØ∑Á≠âÂæÖÂª∂ËøüÊó∂Èó¥ÁªìÊùü');
                }
                return;
            }

            const selectedBox = gameState.boxes[index];

            // ÂÅúÊ≠¢Âä®Áîª
            if (gameState.animationId) {
                cancelAnimationFrame(gameState.animationId);
                gameState.animationId = null;
            }

            // ÊòæÁ§∫ÊâÄÊúâÁõíÂ≠êÂÜÖÂÆπ
            gameState.boxes.forEach(box => {
                box.element.classList.remove('hidden');
            });

            // Ê£ÄÊü•ÈÄâÊã©ÊòØÂê¶Ê≠£Á°Æ
            if (selectedBox.isClean) {
                selectedBox.element.classList.add('correct');
                showMessage('üéâ ÊÅ≠ÂñúÔºÅ‰Ω†ÊâæÂà∞‰∫ÜÂπ≤ÂáÄÁöÑÁõíÂ≠êÔºÅ');
            } else {
                selectedBox.element.classList.add('wrong');
                // È´ò‰∫ÆÊòæÁ§∫ÊâÄÊúâÊ≠£Á°ÆÁ≠îÊ°à
                gameState.boxes.forEach(box => {
                    if (box.isClean) {
                        box.element.classList.add('correct');
                    }
                });
                showMessage('üí© Ë∏©Âà∞ÁãóÂ±é‰∫ÜÔºÅ');
            }

            // Ê∏∏ÊàèÁªìÊùü
            gameState.isPlaying = false;

            // ÊâãÊú∫ÈÄÇÈÖçÔºöÊÅ¢Â§çÊéßÂà∂Ê†èÂíåÊ†áÈ¢òÊòæÁ§∫
            if (gameState.isMobile) {
                document.body.classList.remove('mobile-gaming');
            }

            // Âª∂ËøüÂêéÈáçÊñ∞ÂêØÁî®ÊéßÂà∂ÂèÇÊï∞ÂíåÊõ¥Êñ∞ÊåâÈíÆ
            setTimeout(() => {
                updateGameButton();
                document.getElementById('totalBoxes').disabled = false;
                document.getElementById('cleanBoxes').disabled = false;
                document.getElementById('showTime').disabled = false;
                document.getElementById('delayTime').disabled = false;
                document.getElementById('animationSpeed').disabled = false;
            }, 2000);
        }

        // ÈáçÁΩÆÊ∏∏Êàè
        function resetGame() {
            // ÂÅúÊ≠¢Âä®Áîª
            if (gameState.animationId) {
                cancelAnimationFrame(gameState.animationId);
                gameState.animationId = null;
            }

            // ÈáçÁΩÆÁä∂ÊÄÅ
            gameState.isPlaying = false;
            gameState.isShowing = false;
            gameState.canSelect = false;

            // ÊâãÊú∫ÈÄÇÈÖçÔºöÊÅ¢Â§çÊéßÂà∂Ê†èÂíåÊ†áÈ¢òÊòæÁ§∫
            if (gameState.isMobile) {
                document.body.classList.remove('mobile-gaming');
            }

            // Ê∏ÖÁ©∫ÂÆπÂô®
            const container = document.getElementById('boxesContainer');
            container.innerHTML = '';

            // ÈöêËóèÂÄíËÆ°Êó∂ÂíåÊ∂àÊÅØ
            document.getElementById('countdown').style.display = 'none';
            hideMessage();

            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅÂíåÈáçÊñ∞ÂêØÁî®ÊéßÂà∂ÂèÇÊï∞
            updateGameButton();
            document.getElementById('totalBoxes').disabled = false;
            document.getElementById('cleanBoxes').disabled = false;
            document.getElementById('showTime').disabled = false;
            document.getElementById('delayTime').disabled = false;
            document.getElementById('animationSpeed').disabled = false;
        }

        // ÊòæÁ§∫Ê∂àÊÅØ
        function showMessage(text, duration = 3000) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.classList.add('show');

            setTimeout(() => {
                hideMessage();
            }, duration);
        }

        // ÈöêËóèÊ∂àÊÅØ
        function hideMessage() {
            const messageEl = document.getElementById('message');
            messageEl.classList.remove('show');
        }

        // ÊòæÁ§∫Áä∂ÊÄÅÊèêÁ§∫ÔºàÂ∫ïÈÉ®Â∞èÂ≠óÔºâ
        function showStatusHint(text) {
            const hintEl = document.getElementById('statusHint');
            hintEl.textContent = text;
            hintEl.classList.remove('show');
            // Âº∫Âà∂ÈáçÁªò‰ª•ÈáçÊñ∞Ëß¶ÂèëÂä®Áîª
            hintEl.offsetHeight;
            hintEl.classList.add('show');

            // 2ÁßíÂêéËá™Âä®ÈöêËóè
            setTimeout(() => {
                hintEl.classList.remove('show');
            }, 2000);
        }

        // Êõ¥Êñ∞Ê∏∏ÊàèÊåâÈíÆÁä∂ÊÄÅ
        function updateGameButton() {
            const btn = document.getElementById('gameBtn');
            if (gameState.isPlaying) {
                btn.textContent = 'ÈáçÊñ∞ÂºÄÂßã';
                btn.disabled = false;
            } else {
                btn.textContent = 'ÂºÄÂßãÊ∏∏Êàè';
                btn.disabled = false;
            }
        }

        // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂ÈáçÊñ∞ÊéíÂàóÁõíÂ≠êÂíåÊ£ÄÊµãËÆæÂ§á
        window.addEventListener('resize', () => {
            // ÈáçÊñ∞Ê£ÄÊµãÊòØÂê¶‰∏∫ÊâãÊú∫ËÆæÂ§á
            detectMobile();

            if (!gameState.isPlaying && gameState.boxes.length > 0) {
                arrangeBoxes();
            }
        });

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            // ÂàùÂßãÂåñÊâãÊú∫Ê£ÄÊµã
            detectMobile();

            // È™åËØÅËæìÂÖ•ÂÄº
            document.getElementById('totalBoxes').addEventListener('change', function() {
                const cleanBoxes = parseInt(document.getElementById('cleanBoxes').value);
                const totalBoxes = parseInt(this.value);
                if (cleanBoxes >= totalBoxes) {
                    document.getElementById('cleanBoxes').value = Math.max(1, totalBoxes - 1);
                }
            });

            document.getElementById('cleanBoxes').addEventListener('change', function() {
                const totalBoxes = parseInt(document.getElementById('totalBoxes').value);
                const cleanBoxes = parseInt(this.value);
                if (cleanBoxes >= totalBoxes) {
                    this.value = Math.max(1, totalBoxes - 1);
                }
            });

            // Âª∂ËøüÊó∂Èó¥ËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÁõëÂê¨
            document.getElementById('delayTime').addEventListener('change', function() {
                const delay = parseInt(this.value);
                if (delay < 0) {
                    this.value = 0;
                }
            });

            // Âä®ÁîªÈÄüÂ∫¶ËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÁõëÂê¨
            document.getElementById('animationSpeed').addEventListener('change', function() {
                const speed = parseFloat(this.value);
                // È™åËØÅËæìÂÖ•ÂÄº
                if (speed < 0.5) {
                    this.value = 0.5;
                    return;
                }
                if (speed > 5) {
                    this.value = 5;
                    return;
                }
                // Â¶ÇÊûúÊ∏∏ÊàèÊ≠£Âú®ËøõË°å‰∏≠ÔºåÂÆûÊó∂Êõ¥Êñ∞ÈÄüÂ∫¶
                if (gameState.isPlaying && !gameState.isShowing) {
                    gameState.animationSpeed = speed;
                }
            });
        });
    </script>
</body>
</html>
