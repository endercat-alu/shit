<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shit Storm - ğŸ’©é£æš´</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            user-select: none;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            cursor: crosshair;
        }

        #bigShit {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            cursor: pointer;
            transition: transform 0.2s ease;
            animation: pulse 2s infinite;
        }

        #bigShit:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        .smallShit {
            position: absolute;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: bounce 1s ease-out;
        }

        .smallShit:hover {
            transform: scale(1.2);
        }

        @keyframes bounce {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        @keyframes explode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .exploding {
            animation: explode 0.3s ease-out forwards;
        }

        #controlPanel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: bold;
        }

        .control-group input {
            padding: 5px;
            border: none;
            border-radius: 5px;
            width: 60px;
            text-align: center;
        }

        #startBtn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        #startBtn:hover {
            background: #ff5252;
        }



        #gameInfo {
            position: fixed;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 18px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 10px;
        }

        #timer {
            font-size: 18px;
            font-weight: bold;
            color: #ffeb3b;
        }

        #gameOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-size: 24px;
            text-align: center;
        }

        #gameOverlay h2 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        #restartBtn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
        }

        .instructions {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            font-size: 14px;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .instructions:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .instructions.hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="bigShit">ğŸ’©</div>
        
        <div id="gameInfo">
            <div>å‰©ä½™ğŸ’©: <span id="shitCount">0</span></div>
            <div>å¾—åˆ†: <span id="score">0</span></div>
            <div id="timer">å‡†å¤‡å¼€å§‹</div>
        </div>

        <div class="instructions" id="instructions">
            <h3>æ¸¸æˆè¯´æ˜ <small>(ç‚¹å‡»éšè—)</small></h3>
            <p>â€¢ ç‚¹å‡»å¤§ğŸ’©å¼€å§‹æ¸¸æˆ</p>
            <p>â€¢ å¿«é€Ÿç‚¹å‡»å°ğŸ’©æ¶ˆç­å®ƒä»¬</p>
            <p>â€¢ å°ğŸ’©ä¼šåœ¨æ—¶é—´å†…åˆ†è£‚</p>
            <p>â€¢ åœ¨æ—¶é—´ç»“æŸå‰æ¶ˆç­æ‰€æœ‰ğŸ’©</p>
        </div>
    </div>

    <div id="controlPanel">
        <div class="control-group">
            <label for="shitCount">åˆå§‹ğŸ’©æ•°é‡ (N):</label>
            <input type="number" id="shitCountInput" value="5" min="3" max="15">
        </div>
        <div class="control-group">
            <label for="splitTime">åˆ†è£‚æ—¶é—´ (tç§’):</label>
            <input type="number" id="splitTimeInput" value="3" min="1" max="10">
        </div>
        <div class="control-group">
            <label for="totalTime">æ€»æ—¶é—´ (Tç§’):</label>
            <input type="number" id="totalTimeInput" value="30" min="10" max="120">
        </div>
        <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
    </div>

    <div id="gameOverlay">
        <h2 id="gameResult"></h2>
        <p id="gameStats"></p>
        <button id="restartBtn">å†æ¥ä¸€å±€</button>
    </div>

    <script>
        class ShitStorm {
            constructor() {
                this.gameContainer = document.getElementById('gameContainer');
                this.bigShit = document.getElementById('bigShit');
                this.timer = document.getElementById('timer');
                this.shitCountDisplay = document.getElementById('shitCount');
                this.scoreDisplay = document.getElementById('score');
                this.gameOverlay = document.getElementById('gameOverlay');
                this.gameResult = document.getElementById('gameResult');
                this.gameStats = document.getElementById('gameStats');
                this.instructions = document.getElementById('instructions');

                this.isGameActive = false;
                this.smallShits = [];
                this.score = 0;
                this.gameTimer = null;
                this.splitTimers = [];
                this.timeLeft = 0;

                this.initEventListeners();
            }

            initEventListeners() {
                this.bigShit.addEventListener('click', () => this.startGame());
                document.getElementById('startBtn').addEventListener('click', () => {
                    if (this.isGameActive) {
                        this.restartGame();
                    } else {
                        this.startGame();
                    }
                });
                document.getElementById('restartBtn').addEventListener('click', () => this.restartGame());

                // è§„åˆ™æ¡†ç‚¹å‡»éšè—
                this.instructions.addEventListener('click', () => {
                    this.instructions.classList.add('hidden');
                });
            }

            startGame() {
                if (this.isGameActive) return;
                
                this.isGameActive = true;
                this.score = 0;
                this.smallShits = [];
                this.splitTimers = [];
                
                // è·å–è®¾ç½®å‚æ•°
                const N = parseInt(document.getElementById('shitCountInput').value);
                const t = parseInt(document.getElementById('splitTimeInput').value);
                const T = parseInt(document.getElementById('totalTimeInput').value);
                
                this.splitTime = t * 1000; // è½¬æ¢ä¸ºæ¯«ç§’
                this.timeLeft = T;
                this.totalTime = T; // è®°å½•æ€»æ—¶é—´ç”¨äºè®¡ç®—é€šå…³æ—¶é—´
                
                // éšè—å¤§ğŸ’©
                this.bigShit.style.display = 'none';

                // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                document.getElementById('startBtn').textContent = 'é‡æ–°å¼€å§‹';

                // åˆ›å»ºå°ğŸ’©
                this.createSmallShits(N);

                // å¼€å§‹è®¡æ—¶å™¨
                this.startTimer();

                this.updateDisplay();
            }

            createSmallShits(count) {
                for (let i = 0; i < count; i++) {
                    this.createSmallShit();
                }
            }

            createSmallShit() {
                const shit = document.createElement('div');
                shit.className = 'smallShit';
                shit.textContent = 'ğŸ’©';

                // è®¡ç®—å®‰å…¨åŒºåŸŸï¼Œé¿å¼€ä¿¡æ¯æ¡†å’Œè§„åˆ™æ¡†
                let x, y;
                let attempts = 0;
                const maxAttempts = 50;

                do {
                    x = Math.random() * (window.innerWidth - 80);
                    y = Math.random() * (window.innerHeight - 220) + 50;
                    attempts++;
                } while (this.isInRestrictedArea(x, y) && attempts < maxAttempts);

                // å¦‚æœå°è¯•å¤šæ¬¡ä»åœ¨é™åˆ¶åŒºåŸŸï¼Œä½¿ç”¨å®‰å…¨çš„ä¸­å¿ƒåŒºåŸŸ
                if (this.isInRestrictedArea(x, y)) {
                    x = window.innerWidth / 2 + (Math.random() - 0.5) * 200;
                    y = window.innerHeight / 2 + (Math.random() - 0.5) * 200;
                }

                shit.style.left = x + 'px';
                shit.style.top = y + 'px';
                
                shit.addEventListener('click', (e) => this.clickShit(e, shit));

                this.gameContainer.appendChild(shit);
                this.smallShits.push(shit);

                // è®¾ç½®åˆ†è£‚è®¡æ—¶å™¨
                this.setSplitTimer(shit);
            }

            setSplitTimer(shit) {
                const splitTimer = setTimeout(() => {
                    if (this.isGameActive && this.smallShits.includes(shit)) {
                        this.splitShit(shit);
                    }
                }, this.splitTime);

                this.splitTimers.push(splitTimer);

                // å°†è®¡æ—¶å™¨IDå­˜å‚¨åœ¨ğŸ’©å…ƒç´ ä¸Šï¼Œæ–¹ä¾¿åç»­æ¸…ç†
                shit.splitTimerId = splitTimer;
            }

            isInRestrictedArea(x, y) {
                // æ£€æŸ¥æ˜¯å¦åœ¨å·¦ä¸Šè§’ä¿¡æ¯æ¡†åŒºåŸŸ (å¤§çº¦ 350x120 åƒç´ )
                if (x < 370 && y < 140) {
                    return true;
                }

                // æ£€æŸ¥æ˜¯å¦åœ¨å³ä¸Šè§’è§„åˆ™æ¡†åŒºåŸŸ (å¤§çº¦ 320x180 åƒç´ )
                // åªæœ‰å½“è§„åˆ™æ¡†å¯è§æ—¶æ‰é™åˆ¶è¿™ä¸ªåŒºåŸŸ
                if (!this.instructions.classList.contains('hidden') &&
                    x > window.innerWidth - 340 && y < 200) {
                    return true;
                }

                // æ£€æŸ¥æ˜¯å¦åœ¨åº•éƒ¨æ§åˆ¶é¢æ¿åŒºåŸŸ (é«˜åº¦çº¦ 120 åƒç´ ï¼ŒåŒ…å«paddingå’Œå†…å®¹)
                if (y > window.innerHeight - 140) {
                    return true;
                }

                return false;
            }

            clickShit(event, shit) {
                event.stopPropagation();

                if (!this.isGameActive) return;

                // æ¸…é™¤è¯¥ğŸ’©çš„åˆ†è£‚è®¡æ—¶å™¨
                if (shit.splitTimerId) {
                    clearTimeout(shit.splitTimerId);
                    const timerIndex = this.splitTimers.indexOf(shit.splitTimerId);
                    if (timerIndex > -1) {
                        this.splitTimers.splice(timerIndex, 1);
                    }
                }

                // æ·»åŠ çˆ†ç‚¸æ•ˆæœ
                shit.classList.add('exploding');

                setTimeout(() => {
                    const index = this.smallShits.indexOf(shit);
                    if (index > -1) {
                        this.smallShits.splice(index, 1);
                        shit.remove();
                        this.score += 10;
                        this.updateDisplay();

                        // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
                        if (this.smallShits.length === 0) {
                            this.endGame(true);
                        }
                    }
                }, 300);
            }

            splitShit(originalShit) {
                if (!this.isGameActive) return;

                // æ¸…é™¤åŸğŸ’©çš„è®¡æ—¶å™¨å¼•ç”¨
                if (originalShit.splitTimerId) {
                    const timerIndex = this.splitTimers.indexOf(originalShit.splitTimerId);
                    if (timerIndex > -1) {
                        this.splitTimers.splice(timerIndex, 1);
                    }
                }

                // ä¸ºåŸğŸ’©é‡æ–°è®¾ç½®åˆ†è£‚è®¡æ—¶å™¨
                this.setSplitTimer(originalShit);

                // åˆ›å»ºæ–°çš„ğŸ’©ï¼ˆä¹Ÿä¼šè‡ªåŠ¨è®¾ç½®åˆ†è£‚è®¡æ—¶å™¨ï¼‰
                this.createSmallShit();
                this.updateDisplay();
            }

            startTimer() {
                this.gameTimer = setInterval(() => {
                    this.timeLeft--;
                    this.timer.textContent = `æ—¶é—´: ${this.timeLeft}s`;
                    
                    if (this.timeLeft <= 0) {
                        this.endGame(false);
                    }
                }, 1000);
                
                this.timer.textContent = `æ—¶é—´: ${this.timeLeft}s`;
            }

            endGame(victory) {
                this.isGameActive = false;

                // æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
                clearInterval(this.gameTimer);
                this.splitTimers.forEach(timer => clearTimeout(timer));
                this.splitTimers = [];

                // è®¡ç®—é€šå…³æ—¶é—´
                const usedTime = this.totalTime - this.timeLeft;

                // æ˜¾ç¤ºç»“æœ
                if (victory) {
                    this.gameResult.textContent = 'ğŸ‰ ä½ æŠŠğŸ’©æ·¹æ²¡äº†ï¼';
                    this.gameResult.style.color = '#4caf50';
                    this.gameStats.textContent = `é€šå…³æ—¶é—´: ${usedTime}ç§’ | æœ€ç»ˆå¾—åˆ†: ${this.score}`;
                } else {
                    this.gameResult.textContent = 'ğŸ’© ä½ è¢«ğŸ’©æ·¹æ²¡äº†ï¼';
                    this.gameResult.style.color = '#f44336';
                    this.gameStats.textContent = `æœ€ç»ˆå¾—åˆ†: ${this.score} | å‰©ä½™ğŸ’©: ${this.smallShits.length}`;
                }

                this.gameOverlay.style.display = 'flex';
            }

            restartGame() {
                // æ¸…ç†æ¸¸æˆçŠ¶æ€
                this.smallShits.forEach(shit => shit.remove());
                this.smallShits = [];
                this.splitTimers.forEach(timer => clearTimeout(timer));
                this.splitTimers = [];
                clearInterval(this.gameTimer);
                
                // é‡ç½®UI
                this.bigShit.style.display = 'block';
                this.gameOverlay.style.display = 'none';
                this.timer.textContent = 'å‡†å¤‡å¼€å§‹';
                this.isGameActive = false;
                this.score = 0;

                // é‡ç½®æŒ‰é’®æ–‡æœ¬
                document.getElementById('startBtn').textContent = 'å¼€å§‹æ¸¸æˆ';

                this.updateDisplay();
            }

            updateDisplay() {
                this.shitCountDisplay.textContent = this.smallShits.length;
                this.scoreDisplay.textContent = this.score;
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        const game = new ShitStorm();
    </script>
</body>
</html>
